{
  "kind": "build_request",
  "title": "Fix “PDF.js library not loaded” error for PDF karigar mapping uploads",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Load the PDF.js browser library so that PDF uploads in Karigar Mapping can be parsed without throwing \"PDF.js library not loaded\".",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "PDF.js library not loaded\n\nError pertains in karigar mapping"
        ]
      },
      "acceptanceCriteria": [
        "Uploading a .pdf in the Karigar Mapping tab no longer fails with the error text \"PDF.js library not loaded\".",
        "The PDF.js library is available at runtime as window.pdfjsLib before parseKarigarMapping(file) attempts to parse a PDF."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Configure PDF.js worker setup at runtime (e.g., set pdfjsLib.GlobalWorkerOptions.workerSrc) so PDF parsing works reliably in production builds on the Internet Computer.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "PDF.js library not loaded\n\nError pertains in karigar mapping"
        ]
      },
      "acceptanceCriteria": [
        "PDF parsing works in production (not just local dev) for at least one multi-page PDF mapping file.",
        "No console error about missing/failed PDF worker occurs during PDF parsing (or a documented fallback disables the worker cleanly without breaking parsing)."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Improve the Karigar Mapping upload error message for missing PDF.js so it is actionable for end users (English), including guidance to retry or use Excel as a fallback when PDF parsing is unavailable.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "PDF.js library not loaded\n\nError pertains in karigar mapping"
        ]
      },
      "acceptanceCriteria": [
        "When PDF parsing cannot start due to missing/unavailable PDF.js, the UI displays an English error message that tells the user what to do next (e.g., refresh/retry, or upload .xlsx/.xls instead).",
        "The error is shown in the existing Karigar Mapping tab error area and preserves whitespace formatting (whitespace-pre-wrap)."
      ]
    }
  ],
  "constraints": [
    "Do not modify any files under frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useInternetIdentity.tsx, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, or frontend/src/components/ui (immutable paths).",
    "Keep all changes within the existing single-page React app; do not add new backend services."
  ],
  "nonGoals": [
    "Changing the karigar mapping data model or backend storage format.",
    "Implementing PDF export or generating PDFs for downloads (this issue is only about parsing uploaded PDF mapping files)."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}